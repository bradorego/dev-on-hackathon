"use strict";angular.module("africaSmsApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/signIn",{templateUrl:"views/signIn.html",controller:"SignInCtrl"}).when("/signUp",{templateUrl:"views/signUp.html",controller:"SignUpCtrl"}).when("/lists",{templateUrl:"views/lists.html",controller:"ListsCtrl"}).when("/lists/:id",{templateUrl:"views/listView.html",controller:"ListViewCtrl"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl"}).otherwise({redirectTo:"/"})}]).run(["$location","EverythingFactory","$rootScope",function(a,b,c){b.getUser()._id||a.path("/signIn"),c.signOut=function(){window.location.reload()}}]).directive("phoneNumber",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.phone=function(a,b){return d.$isEmpty(a)?!0:(b=b.replace(/\D/g,""),10===b.length||11===b.length&&"1"===b.charAt(0)?!0:!1)}}}}),angular.module("africaSmsApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("africaSmsApp").controller("HistoryCtrl",["$scope","EverythingFactory",function(a,b){b.getHistory().then(function(b){a.history=b})}]),angular.module("africaSmsApp").controller("ListsCtrl",["$scope","$location","EverythingFactory",function(a,b,c){c.getLists().then(function(b){a.lists=b}),a.goToList=function(a){b.path("/lists/"+a.id)},a.createList=function(){var b=window.prompt("What is this list's name?");b&&c.addList(b).then(function(b){a.lists=b.distributionLists})},a.isModalOpen=!1,a.newMessage=function(){a.isModalOpen=!0},a.messageSent=function(b){b.text&&c.sendMessage(b.list,b.text).then(function(b){console.log(b),a.isModalOpen=!1})},a.closeModal=function(){a.isModalOpen=!1}}]),angular.module("africaSmsApp").controller("ListViewCtrl",["$scope","$routeParams","EverythingFactory","$location",function(a,b,c,d){c.getListById(b.id).then(function(b){a.list=b}),a.deleteList=function(){window.confirm("Are you sure you want to delete this list? All numbers will be lost.")&&c.removeList(a.list.id).then(function(){d.path("/lists")})},a.editName=function(){var b=window.prompt("What is this list's name?",a.list.name);b&&c.editList(a.list.id,b).then(function(b){a.list.name=b})},a.addNumber=function(b){b&&c.addNumberToList(a.list.id,b).then(function(b){a.list=b,a.number=""})},a.removeNumber=function(b){window.confirm("Are you sure you want to delete this number?")&&c.removeNumberFromList(a.list.id,b).then(function(b){a.list=b})},a.isModalOpen=!1,a.showModal=function(){a.isModalOpen=!0},a.closeModal=function(){a.isModalOpen=!1},a.messageSent=function(b){window.alert(b),a.isModalOpen=!1}}]),angular.module("africaSmsApp").controller("SignUpCtrl",["$scope","EverythingFactory","$location",function(a,b,c){a.user={email:"",password:""},a.signUp=function(d){b.signUp(d.email,d.password).then(function(b){a.$root.user=b,c.path("/lists")})}}]),angular.module("africaSmsApp").controller("SignInCtrl",["$scope","$location","EverythingFactory",function(a,b,c){a.user={email:"me@bradorego.com",password:"TestWord"},a.signIn=function(d){a.error="",c.signIn(d.email,d.password).then(function(c){c._id?(a.$root.user=c,b.path("/lists")):a.error=101===c.code?"User not found":102===c.code?"Wrong Password":"Unknown error"})}}]),angular.module("africaSmsApp").directive("sendModal",function(){var a={};return a.templateUrl="/views/_send_modal.html",a.restrict="EA",a.scope={lists:"=",messageSent:"&onMessageSent",closeModal:"&"},a.controller=["$scope",function(a){a.message={list:"",text:""}}],a}),angular.module("africaSmsApp").factory("EverythingFactory",["$http","$q",function(a,b){var c={},d={},e="/";return c.signIn=function(d,f){var g=b.defer();return a.post(e+"signIn",{email:d,password:f}).success(function(a){c.setUser(a),g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},c.signUp=function(d,f){var g=b.defer();return a.post(e+"signUp",{email:d,password:f}).success(function(a){c.setUser(a),g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},c.setUser=function(a){return d=a},c.getUser=function(){return d},c.addList=function(c){var f=b.defer();return a.post(e+"users/"+d._id+"/lists",{name:c}).success(function(a){d=a,f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},c.editList=function(c,f){var g=b.defer();return a.put(e+"users/"+d._id+"/lists/"+c,{name:f}).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},c.removeList=function(c){var f=b.defer();return a.delete(e+"users/"+d._id+"/lists/"+c).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},c.addNumberToList=function(c,f){var g=b.defer();return a.post(e+"users/"+d._id+"/lists/"+c+"/"+f).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},c.removeNumberFromList=function(c,f){var g=b.defer();return a.delete(e+"users/"+d._id+"/lists/"+c+"/"+f).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},c.getLists=function(){var c=b.defer();return a.get(e+"users/"+d._id+"/lists").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},c.getListById=function(c){var f=b.defer();return a.get(e+"users/"+d._id+"/lists/"+c).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},c.getHistory=function(){var c=b.defer();return a.get(e+"users/"+d._id+"/history").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},c.sendMessage=function(c,f){var g=b.defer();return a.post(e+"sendMessage",{list:c,userId:d._id,message:f}).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise},c}]);